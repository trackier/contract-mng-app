<div class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-12" style="margin-bottom: 10px;">
				<div class="col-10">
					<div class="page-title-box">
					
					</div>
					{echo Shared\Markup::message($message ?? null)}
				</div>
				<div class="card shadow mb-4">
					<div class="card-header py-3">
						<h6 class="m-0 font-weight-bold text-primary">Purchase Order Search </h6>
					</div>
					<form class="card-body" method="get">
						<div class="form-row">
							<div class="form-group col-sm-2">PO ID</div>
							<div class="form-group col-sm-2">Name</div>
							<div class="form-group col-sm-2">Invoice Mode</div>
							<div class="form-group col-sm-2">Vendor</div>
						</div>
						<div class="form-row">
							<div class="form-group col-sm-2">
								<input type="text" name="query[_id]" class="form-control" value="{echo $query['_id']}" placeholder = "Search PO ID">
							</div>

							<div class="form-group col-sm-2">
									<input type="text" name="query[name]" class="form-control" value="{echo $query['name']}" placeholder = "Name">
							</div>
							<div class="form-group col-sm-2">
								<select class="form-control" name="query[invoice_mood]" value="{echo $query['invoice_mood']}">
									<option value="">All</option>
									<option value="annually">Annually</option>
									<option value="monthly">Monthly</option>
									<option value="onDemand">On Demand</option>
								</select>
							</div>
							<div class="form-group col-sm-2">
								<select class="form-control" name="query[vendor_id]" value="{echo $query['vendor_id']}">
									<option value="">All</option>
									{foreach $v in $vendors}
									<option value="{echo $v->_id}">({echo $v->name}) {echo $v->company_name}</option>
									{/foreach}
								</select>
							</div>
							<div class="col-sm-4">
								<button type="submit" class="btn btn-rounded  btn-primary btn-custom w-md waves-effect waves-light">
								<i class="fa fa-search"></i> Submit
								</button>
							</div>
						</div>
					</form>
				</div>
				{if $purchaseOrder}
				<div class="card shadow mb-4">
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
								<thead>
									<tr>
										<th>PO ID</th>
										<th>Name</th>
										<th>Start Date</th>
										<th>End Date</th>
										<th>Vendor</th>
										<th>Invoice Mode</th>
										<th>Description</th>
										<th>Amount</th>
										<th></th>
									</tr>
								</thead>
								<tbody>
									{foreach $obj in $purchaseOrder}
										<tr data-id='{echo $obj->_id}'>
											<td>{echo $obj->_id}</td>
											<td>{echo $obj->name}</td>
											<td>{echo \Framework\TimeZone::printDateFormatted($obj->startDate)}</td>
											<td>{echo \Framework\TimeZone::printDateFormatted($obj->endDate)}</td>
											<td>
												{if $obj->vendor_id}
													{script $v = $vendors[$obj->vendor_id]}
													{if $v}
														({echo $v->name}) {echo $v->company_name}
													{/if}
												{/if}
											</td>
											<td>{echo $obj->invoice_mood}</td>
											<td>{echo $obj->description}</td>
											<td> {script $total =  \Models\purchasereq::getAmountSingle($obj)}
												<div class="detail">{$total}</div></td>
											<td>
												<a class="btn btn-outline-primary"  href="/purchaseorder/add/{echo $obj->_id}" padding="10px"><i class="fa fa-pencil-square-o" style="margin-right:5px" ></i>Edit</a>
												<a class="btn btn-outline-danger"  href="/purchaseorder/delete/{echo $obj->_id}" padding="10px"><i class="fa fa-trash" ></i>Delete</a>
												{/if}
											</td>
										</tr>
									{/foreach}
								</tbody>
							</table>
						</div>
					</div>
				</div>
				{/if} {else}
				<div class="card-body">
					<p class="card-text">No requests found</p>
				</div>
				{/else}
			</div>
		</div>
	</div>
</div>

<script  type="text/javascript">
	$(document).ready(function () {
		var start = '$start' ? moment('$start') : moment().subtract(29, 'days');
		var end = '$end' ? moment('$end') : moment();function cb(start, end) {
			$('#start').attr('value', start.format('YYYY-MM-DD'));
			$('#end').attr('value', end.format('YYYY-MM-DD'));
			$('#viewrange span').html(start.format('DD-MM-YYYY') + ' - ' + end.format('DD-MM-YYYY'));
		}
		$('#viewrange').daterangepicker({
			startDate: start,
			endDate: end,
			ranges: {
				'Today': [moment(), moment()],
				'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
				'Last 7 Days': [moment().subtract(6, 'days'), moment()],
				'Last 30 Days': [moment().subtract(29, 'days'), moment()],
				'This Month': [moment().startOf('month'), moment().endOf('month')],
				'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
			}
		}, cb);
		cb(start, end);

	});

</script>