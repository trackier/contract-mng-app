
<div class="content">
	<div class="container-fluid" >
		<div class="row" style="margin-bottom: 10px;">
			<div class="col-10">
				<div class="page-title-box">
					<h4 class="page-title">Add Purchase request Details</h4>
					
					<div class="clearfix"></div>
				</div>
				{echo Shared\Markup::message($message ?? null)}
			</div>
			<div class="col-2">
				<a href="/purchasereq/viewall" class="btn btn-xs btn-outline-info">View All<i class="fa fa-eye"></i></a>
			</div>
		</div>
		<div class="row">
			<div class="col-sm-12">
				<div class="card">
					<div class="card-body" style = "width: 100%;">
						<form class="form-horizontal m-t-20"  method="post" enctype="multipart/form-data">
							<input type="submit" class="button add-row" value="Add another line" />
							<table id="table"  name="data[details]" >
								<thead>
									<tr>
										<th>Name</th>
										<th>Quantity</th>
										<th>Estimate rate</th>
										<th>Category</th>
									
									</tr>
								</thead>
								<tbody>
									<tr  id="tbl">
										<td><input class="form-control" id="name" type="text"   /></td>
										<td><input class="form-control"  id="quantity" type="number" /></td> 
										<td><input class="form-control"   id="erate" type="number"/></td>   
										<td><select class="form-control"  id="category"   required="">
											{foreach $category in $categories}
											<option value="{echo $category}">{echo $category}</option>
											{/foreach}
										</select></td>   
									</tr>
								</tbody>
							
							</table>
						
							<div class="form-group row">
								<div class="form-group col-6">
									<div class="col-xs-12">
										<label>Activity <span ></span></label>
										<select class="form-control"  name="data[activity_id]" >
											<option selected value="">Select Activity</option>
											{foreach $activity in $activities}
											<option value="{echo $activity->_id}">{echo $activity->name}</option>
											{/foreach}
											
										</select>
									</div>
								</div>
								<div class="form-group col-6">
									<div class="col-xs-12">
										<label>Expected Date <span class="required"></span></label>
										<input class="form-control" type="date" name="data[expectedDate]" required="" placeholder="Expected Date">
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<div class="col-xs-12">
									<label>Notes <span class="required"></span></label>
									<textarea class="form-control" type="text" required="" name="data[notes]"  placeholder="notes">{echo @$contractDetails->notes}</textarea>
								</div>
							</div>
							
							
							<p>Select files to upload:
								<input type="file" class="upload__input" name="files[]" multiple><br><br>
							</p>
							
							{foreach $doc in  $files }
							<table >
								<td style="padding-right: 20px;width:300px">
									{echo $doc->filename}
								</td>
								<td style="padding-right: 20px;">
									<a   data-toggle="modal" data-target="#fileDelModal"  data-id='{echo $contractDetails->id}' data-fileid='{echo $doc->fileId}' class="open-fileDelModal btn btn-xs btn-outline-warning">Delete <i class="fa fa-trash"></i></a>
								</td>
								<td>
									<a  href="/contract/downloadFile/{$doc->fileId}" class="btn btn-xs btn-outline-warning">Download <i class="fa fa-download"></i></a>
								</td>
							</table>
							
						</br>
							{/foreach}
						
							<input type="hidden" name="action" value="addContract">
							<div class="form-group text-right m-t-20">
								<div class="col-xs-12">
									<button class="btn btn-rounded  btn-primary btn-custom w-md waves-effect waves-light" type="submit">Add Purchase Request</button>
								</div>
							</div>
							<div>
							<hr>
							</div>
						</form>
					
					</div>
				</div>
			</div>
		</div>
		<br>
	
	</div>
</div>

<div class="modal fade" id="fileDelModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
aria-hidden="true">
<div class="modal-dialog" role="document">
	<div class="modal-content">
		<div class="modal-header">
			<h5 class="modal-title" id="exampleModalLabel">Remove file?</h5>
			<button class="close" type="button" data-dismiss="modal" aria-label="Close">
				<span aria-hidden="true">Ã—</span>
			</button>
		</div>
		<div class="modal-body">Do you want to remove file? Once removed file will be deleted from system in a week  </div>
		<div class="modal-footer">
			<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
			<a class="btn btn-primary" id="fileId">Remove</a>
		</div>
	</div>
</div>
</div>


<script type="text/javascript">
$('.open-fileDelModal').on('click', function () {
	console.log('here')
	var contractId = $(this).data('id');
	var fileId = $(this).data('fileid');
	$("#fileId").attr('href','/purchasereq/deleteFile/'+fileId+'/'+contractId);
})

$('.add-row').on('click', function(e){
	
	var filterCount = document.getElementById("table").querySelectorAll("tbody tr").length;
		var ele = $("#tbl").clone();
		ele.css('visibility', 'visible'); 
		ele.find('#name').attr('name','data[items]['+filterCount+'][name]')
		ele.find('#quantity').attr('name','data[items]['+filterCount+'][quantity]')
		ele.find('#erate').attr('name','data[items]['+filterCount+'][erate]')
		ele.find('#category').attr('name','data[items]['+filterCount+'][category]')
		$("#table").append(ele);

});

</script>
<style>
.geo-row {
	background-color: #f3f3f3;
	padding: 5px;
	margin-bottom: 10px;
	border-radius: 5px;
	display: flex;
	align-items: center
}
#tbl{
	visibility: hidden;
}

/* #loading {
position: absolute;
top: 0;
width: 100%;
height: 100%;
text-align: center;
visibility: hidden;
}

#content {
position: absolute;
top: 0;
width: 100%;
height: 100%;
visibility: hidden;
} */
</style>