<div class="content">
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-12" style="margin-bottom: 10px;">
				
				<form class="card-body" method="get">
					<div class="form-row">
						<div class="form-group col-2"> Select Status</div>
						<div class="form-group col-2">
							<select  onchange="this.form.submit()" class="form-control" name="query[status]" value="{echo $query['status'] ?? ''}">
								<option value="">All</option>
								<option value="pending">Awaiting Approval</option>
								<option value="approved">Approved</option>
								<option value="rejected by department">Rejected by department</option>
								<option value="rejected">Rejected</option>
							</select>
						</div>
					</div>
					
				</form>
				{if $purchasereq}
				<div class="card shadow mb-4">
					
					<div class="text-start px-md-2" style="margin:10px">
						<a class="btn btn-primary"  href="/purchasereq/add" padding="10px"><i class="fa fa-plus"></i> Add new Purchase Request </a>
					</div>
					
					
					<div class="card-body">
						<div class="table-responsive">
							<table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
								<thead>
									<tr>
										<th>PR Id</th>
										<th>Expected Date</th>
										<th>Status</th>
										<th>Approver</th>
										<th>Amount</th>
                                        <th></th>
									</tr>
								</thead>
								<tbody>
									{foreach $obj in $purchasereq}
										<tr data-id='{echo $obj->_id}'>
											{script $user2 = User::first(["_id" => $obj->approver1_id], [], ['maxTimeMS' => 5000 ])}
											
											<td>$obj->pr_id</td>
											<td>{echo Framework\TimeZone::printDate($obj->expectedDate)}</td>
											<td>{echo $obj->status}</td>
											<td>{echo $user2->name}</td>
											<td> {script $total =  \Models\purchasereq::getAmount($obj);}
                                       
												<div class="detail">{$total}</div></td>
                                            <td><a class="btn btn-outline-info"  href="/purchasereq/view/{echo $obj->_id}" padding="10px"><i class="fa fa-eye" style="margin-right:5px"></i>View</a>
                                                {if  !(($obj->status=='approved'|| $obj->status=='processed')) }
                                                <a class="btn btn-outline-primary"  href="/purchasereq/edit/{echo $obj->_id}" padding="10px"><i class="fa fa-pencil-square-o" style="margin-right:5px" ></i>Edit</a>
												<a class="btn btn-outline-danger"  href="/purchasereq/delete/{echo $obj->_id}" padding="10px"><i class="fa fa-trash" ></i>Delete</a>

                                                {/if}
                                            </td>
                                            

										</tr>
									{/foreach}
								</tbody>
							</table>
						</div>
					</div>
				</div>
				{/if} {else}
				<div class="card-body">
					<p class="card-text">No requests found</p>
				</div>
				{/else}
			</div>
		</div>
	</div>
</div>